angular.module("ui.colorpicker",["pascalprecht.translate"]).config(["$translateProvider",function(o){o.translations("jp",{PALLETE:"经典",WHELL:"自定义",HISTORY:"历史记录",SELECT:"选择",CANCEL:"取消"}),o.translations("en",{PALLETE:"Pallete",WHELL:"Whell",HISTORY:"History",SELECT:"Select",CANCEL:"Cancel"}),o.translations("pt",{PALLETE:"Paleta",WHELL:"Personalizar",HISTORY:"Recentes",SELECT:"Selecionar",CANCEL:"Cancelar"}),o.preferredLanguage("en")}]).factory("colorpicker.helper",["$document",function(o){return{setCookie:function(o,e){var t=30,r=new Date;r.setTime(r.getTime()+24*t*60*60*1e3),document.cookie=o+"="+escape(e)+";expires="+r.toGMTString()},getCookie:function(o){var e,t=new RegExp("(^| )"+o+"=([^;]*)(;|$)");return(e=document.cookie.match(t))?unescape(e[2]):null},deleteCookie:function(o){var e=new Date;e.setTime(e.getTime()-1);var t=getCookie(o);null!=t&&(document.cookie=o+"="+t+";expires="+e.toGMTString())},enabledCookie:function(o){return"string"==typeof this.getCookie(o)},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(o){return[o[1],o[2],o[3],o[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(o){return[2.55*o[1],2.55*o[2],2.55*o[3],o[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}]}}]).factory("colorpicker.transColor",["colorpicker.helper",function(o){return{value:{h:1,s:1,b:1,a:1},rgb:function(){var o=this.toRGB();return"rgb("+o.r+","+o.g+","+o.b+")"},rgba:function(){var o=this.toRGB();return"rgba("+o.r+","+o.g+","+o.b+","+o.a+")"},hex:function(){return this.toHex()},RGBtoHSB:function(o,e,t,r){o/=255,e/=255,t/=255;var n,a,i,s;return i=Math.max(o,e,t),s=i-Math.min(o,e,t),n=0===s?null:i===o?(e-t)/s:i===e?(t-o)/s+2:(o-e)/s+4,n=(n+360)%6*60/360,a=0===s?0:s/i,{h:n||1,s:a,b:i,a:r||1}},setColor:function(e){e=e.toLowerCase();for(var t in o.stringParsers)if(o.stringParsers.hasOwnProperty(t)){var r=o.stringParsers[t],n=r.re.exec(e),a=n&&r.parse(n);if(a)return this.value=this.RGBtoHSB.apply(null,a),!1}},setHue:function(o){this.value.h=1-o},setSaturation:function(o){this.value.s=o},setLightness:function(o){this.value.b=1-o},setAlpha:function(o){this.value.a=parseInt(100*(1-o),10)/100},toRGB:function(o,e,t,r){o||(o=this.value.h,e=this.value.s,t=this.value.b),o*=360;var n,a,i,s,l;return o=o%360/60,l=t*e,s=l*(1-Math.abs(o%2-1)),n=a=i=t-l,o=~~o,n+=[l,s,0,0,s,l][o],a+=[s,l,l,s,0,0][o],i+=[0,0,s,l,l,s][o],{r:Math.round(255*n),g:Math.round(255*a),b:Math.round(255*i),a:r||this.value.a}},toHex:function(o,e,t,r){var n=this.toRGB(o,e,t,r);return"#"+(1<<24|parseInt(n.r,10)<<16|parseInt(n.g,10)<<8|parseInt(n.b,10)).toString(16).substr(1)}}}]).factory("colorpicker.slider",function(){"use strict";var o={maxLeft:0,maxTop:0,callLeft:null,callTop:null,knob:{top:0,left:0}},e={};return{getOffset:function(o){for(var e=0,t=0,r=o.getBoundingClientRect();o&&!isNaN(o.offsetLeft)&&!isNaN(o.offsetTop);)"BODY"===o.tagName?(e+=document.documentElement.scrollLeft||o.scrollLeft,t+=document.documentElement.scrollTop||o.scrollTop):(e+=o.scrollLeft,t+=o.scrollTop),o=o.offsetParent;return{top:r.top+window.pageYOffset,left:r.left-130+window.pageXOffset,scrollX:e,scrollY:t}},closestSlider:function(o){var e=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.msMatchesSelector;return e.bind(o)("I")?o.parentNode:o},getSlider:function(){return o},getLeftPosition:function(t){return Math.max(0,Math.min(o.maxLeft,o.left+((t.pageX||e.left)-e.left)))},getTopPosition:function(t){return Math.max(0,Math.min(o.maxTop,o.top+((t.pageY||e.top)-e.top)))},setSlider:function(t){var r=this.closestSlider(t.target),n=this.getOffset(r),a=r.getBoundingClientRect(),i=t.clientX-a.left,s=t.clientY-a.top;o.knob=r.children[0].style,o.left=t.pageX-n.left-window.pageXOffset+n.scrollX,o.top=t.pageY-n.top-window.pageYOffset+n.scrollY,e={left:t.pageX-(i-o.left),top:t.pageY-(s-o.top)}},setSaturation:function(e){o={maxLeft:200,maxTop:200,callLeft:"setSaturation",callTop:"setLightness"},this.setSlider(e)},setHue:function(e){o={maxLeft:0,maxTop:200,callLeft:!1,callTop:"setHue"},this.setSlider(e)},setAlpha:function(e){o={maxLeft:0,maxTop:200,callLeft:!1,callTop:"setAlpha"},this.setSlider(e)},setKnob:function(e,t){o.knob.top=e+"px",o.knob.left=t+"px"}}}).directive("colorpicker",["$document","$compile","colorpicker.transColor","colorpicker.slider","colorpicker.helper",function(o,e,t,r,n){"use strict";return{restrict:"AE",replace:!0,scope:{color:"="},template:'<div class="colorpicker-circle">    <div class="circle-inner" ng-style="{\'background-color\':color}"></div></div>',link:function(a,i,s,l){function c(){clearTimeout(L),L=setTimeout(function(){b.css(I()),clearTimeout(L)},100)}a.show=!1,a.colorTab=1,a.colorboxs=["rgba(81,167,249,1)","rgba(112,191,65,1)","rgba(245,211,40,1)","rgba(243,144,25,1)","rgba(236,93,87,1)","rgba(179,106,226,1)","rgba(3,101,192,1)","rgba(0,136,43,1)","rgba(220,189,35,1)","rgba(222,106,16,1)","rgba(200,37,6,1)","rgba(119,63,155,1)","rgba(22,79,134,1)","rgba(11,93,24,1)","rgba(195,151,26,1)","rgba(189,91,12,1)","rgba(134,16,1,1)","rgba(95,50,124,1)","rgba(0,36,82,1)","rgba(5,65,9,1)","rgba(163,117,18,1)","rgba(146,70,7,1)","rgba(87,7,6,1)","rgba(59,31,78,1)","rgba(255,255,255,1)","rgba(220,222,224,1)","rgba(166,170,169,1)","rgba(83,88,95,1)","rgba(0,0,0,1)"],a.historyColorboxs=[];var u="historyColor-"+s.colorType,p=s.colorType,f=angular.element(document.body),d='<div class="colorpicker-mask" ng-show="show" ng-click="select()"></div><div class="colorpicker dropdown" ng-show="show">     <div class="colorpicker-preview">       <div class="inner">       <div class="color-text"></div>       <div class="color-tabs">        <div class="color-tab" ng-class="{true: \'active\', false: \'\'}[colorTab === 1]" ng-click="toggleTab(1)" translate="PALLETE"></div>        <div class="color-tab" ng-class="{true: \'active\', false: \'\'}[colorTab === 2]" ng-click="toggleTab(2)" translate="WHELL"></div>        <div class="color-tab" ng-class="{true: \'active\', false: \'\'}[colorTab === 3]" ng-click="toggleTab(3)" translate="HISTORY"></div>       </div>       </div>     </div>     <div class="tab-colorbox" ng-show="colorTab ===1">       <div ng-repeat="item in colorboxs">          <div class="color-unit" ng-attr-style="background-color:{{::item}}" ng-class="{true:\'active\',false:\'\'}[color === item]" ng-click="selectColorBox(item,$index)"></div>       </div>     </div>     <div class="tab-slider" ng-show="colorTab ===2">       <div class="colorpicker-saturation"><i></i></div>       <div class="colorpicker-hue"><i></i></div>       <div class="colorpicker-alpha"><i></i></div>     </div>     <div class="tab-historyColorbox" ng-show="colorTab ===3">       <div ng-repeat="item in historyColorboxs">           <div class="color-unit-wrap">               <div class="color-unit" ng-attr-style="background-color:{{::item}}" ng-class="{true:\'active\',false:\'\'}[color === item]" ng-click="selectColorBox(item,$index)"></div>           </div>       </div>     </div>     <div class="btn-group">        <button class="cancel" ng-click="cancel()" translate="CANCEL"></button>        <button class="select" ng-click="select()" translate="SELECT"></button>     </div></div>',g=angular.element(d),v=g.eq(0),b=g.eq(1),h=b.find(".colorpicker-hue"),m=b.find(".colorpicker-saturation"),k=b.find(".colorpicker-preview"),C=b.find("i");e(g)(a),f.append(g);var T,x,L,w=t,S=24;a.toggleTab=function(o){a.colorTab=o,P()},a.selectColorBox=function(o,e){w.setColor(o),a.color=w[p](),y()},a.cancel=function(){a.color=x,M("cancel")},a.select=function(){M()};var E=function(){o.on("mousemove",A),o.on("mouseup",H)};"rgba"===p&&(b.addClass("alpha"),T=b.find(".colorpicker-alpha"),T.on("click",function(o){r.setAlpha(o),A(o)}).on("mousedown",function(o){r.setAlpha(o),E()})),h.on("click",function(o){r.setHue(o),A(o)}).on("mousedown",function(o){r.setHue(o),E()}),m.on("click",function(o){r.setSaturation(o),A(o)}).on("mousedown",function(o){r.setSaturation(o),E()});var y=function(){var o=w.value.b>.5?"#000000":"#FFFFFF";k.find(".color-text").text(w[p]()),k.find(".inner").css("backgroundColor",w[p]()),k.find(".color-tabs").css("color",o),k.find(".color-text").css("color",o),m.css("backgroundColor",w.toHex(w.value.h,1,1,1))},A=function(o){var e=r.getLeftPosition(o),t=r.getTopPosition(o),n=r.getSlider();r.setKnob(t,e),n.callLeft&&w[n.callLeft].call(w,e/200),n.callTop&&w[n.callTop].call(w,t/200),y();var i=w[p]();return b.find(".colorpicker-alpha").css({"background-color":i}),a.$apply(function(){a.color=i}),!1},H=function(){o.off("mousemove",A),o.off("mouseup",H)},P=function(){var o=w[p]();w.setColor(o),C.eq(0).css({left:200*w.value.s+"px",top:200-200*w.value.b+"px"}),b.find(".colorpicker-alpha").css({"background-color":o}),C.eq(1).css("top",200*(1-w.value.h)+"px"),C.eq(2).css("top",200*(1-w.value.a)+"px"),y()},I=function(o){var e,t=b.width(),r=b.height(),n=i[0].getBoundingClientRect(),a=n.left,s=n.top,l=($(window).width(),$(window).height());return b.removeClass("position-top"),b.removeClass("position-right"),b.removeClass("position-bottom"),b.removeClass("position-left"),a>t&&l-s>=r?(e={top:s-6,left:a-t+10},b.addClass("position-left")):a>t&&r>l-s?(e={top:s-r+25,left:a-t+10},b.addClass("position-top")):t>a&&l-s>=r?(e={top:s-6,left:a+20},b.addClass("position-right")):(e={top:s-r+25,left:a+20},b.addClass("position-bottom")),{top:e.top+"px",left:e.left+"px"}},B=function(o){x=angular.copy(a.color),w.setColor(x),P();var e=n.getCookie(u);e=null===e?[]:e.split("|"),a.$apply(function(){a.show=!0,a.historyColorboxs=e}),b.css(I(o)),v.css({"z-index":parseInt((new Date).getTime(),10)}),b.css({"z-index":parseInt((new Date).getTime(),10)})};i.on("click",B),b.on("mousedown",function(o){o.stopPropagation(),o.preventDefault()});var M=function(o){a.show=!1,"cancel"!==o&&R()},R=function(){var o=w[p]();if(n.enabledCookie(u)){for(var e=n.getCookie(u),t=e.split("|"),r=0;r<t.length;r++)if(o===t[r])return t.splice(r,1),t.unshift(o),void n.setCookie(u,t.join("|"));t.length>=S?(t.pop(),t.unshift(o),n.setCookie(u,t.join("|"))):n.setCookie(u,o+"|"+e)}else n.setCookie(u,o)};o.bind("scroll",function(){c()}),$(window).on("resize",function(){c()})}}}]);